---
# Copyright 2016 Yahoo Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "deployment.xml"
---

<pre class="brush: xml">
&lt;deployment version="1.0"&gt;
  &lt;test /&gt;
  &lt;staging /&gt;
  &lt;prod global-service-id="query"&gt;
    &lt;region active="true"&gt;us-east-3&lt;/region&gt;
    &lt;region active="false"&gt;us-west-1&lt;/region&gt;
  &lt;/prod&gt;
&lt;/deployment&gt;
</pre>

<p>
The deployment specification defines which environments and regions the application is deployed to.
I.e, use this file to control production locations, refer to <a href="../service/bcp.html">BCP</a> for examples.
This file is stored in the application package root, next to <em>services.xml</em>.
</p>

<dl>
<dt>Development and Performance environments</dt>
<dd>
To start developing, this file is not needed.
Hence, if <em>deployment.xml</em> is not present, the application is only deployed to the <em>dev</em> or <em>perf</em> environments, depending on mvn parameters (see <a href="../developing-with-vespa.html">developing with Vespa</a>).
</dd>

<dt>Test</dt>
<dd>
Add the <em>test</em> element to enable system testing - read more in <a href="../continuous-deployment.html">continuous deployment</a>.
</dd>

<dt>Staging</dt>
<dd>
The <em>staging</em> element enables staging testing - read more in <a href="../continuous-deployment.html">continuous deployment</a>. <em>staging</em> implies <em>test</em>.
</dd>


<dt>Production</dt>
<dd>
<p>The application will automatically be deployed to the listed regions:</p>
<ul>
  <li><em>region</em> must be specified for <em>prod</em> but not for other environments.</li>
  <li><em>prod</em> implies <em>staging</em> and <em>staging</em> implies <em>test</em>, even if those environments are not specified.</li>
  <li>The <em>active</em> attribute is required and controls whether the region should receive production traffic
through the global DNS names of the application.</li>
  <li><em>global-service-id</em> is the id of the <em>&lt;jdisc&gt;</em> element in <em>services.xml</em> which should be the search endpoint for the global DNS names.</li>
</ul>
<p>Applications might have different capacity requirements per environment/region. Examples are different number of nodes, or different node specs. It is possible to tune this, <a href="../capacity-planning.html">example</a> or refer to the <a href="application-packages-reference.html#deploy">deployment reference</a>.</p>
</dd>

</dl>

<h2>Remove / change production instances</h2>
<p>
It is important to only deploy to active and BCP production regions - do not misuse production capacity
(i.e. only set up instances in prod when you are ready to feed data to them, and remove
when not in use).
Remove an instance in a region in two steps:
</p>
<ol>
  <li>
    Locate the instance in the Vespa dashboard and click <em>Delete instance</em> under <em>Options</em>.
    This will free the hosts used back to the free pool.
  </li>
  <li>
Remove the <em>region</em> element in <em>deployment.xml</em> - this will trigger the CD pipeline,
so deployments will not hit this region. E.g:
<pre class="brush: xml">
  &lt;prod global-service-id="query"&gt;
    &lt;region active="true"&gt;us-east-3&lt;/region&gt;
    &lt;!-- region active="false"&gt;us-west-1&lt;/region --&gt;
</pre>
  </li>
</ol>
<p class="alert-success">
Note: changing a region will leave the instance in both regions. E.g. changing from <em>us-east-3</em>
to <em>us-central-1</em> will create an instance in the latter but not delete the instance in <em>us-east-3</em>.
One can easily track production instances in the Vespa dashboard.
</p>

