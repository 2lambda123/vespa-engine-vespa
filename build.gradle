/*
 * This file was generated by the Gradle 'init' task.
 */

allprojects {
    group = 'com.yahoo.vespa'
    version = '7.28.21'
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'maven-publish'
    apply plugin: 'war'

    repositories {
        mavenLocal()
        maven {
            url = 'http://repo.maven.apache.org/maven2'
        }

        maven {
            url = 'https://yahoo.bintray.com/maven'
        }

        maven {
            url = 'https://repository.apache.org/content/groups/public'
        }
    }

    sourceCompatibility = JavaVersion.VERSION_11

    publishing {
        publications {
            maven(MavenPublication) {
                from(components.java)
            }
        }
    }
}


buildscript {
  repositories {
        mavenLocal()
        maven {
            url = 'http://repo.maven.apache.org/maven2'
        }

        maven {
            url = 'https://yahoo.bintray.com/maven'
        }

        maven {
            url = 'https://repository.apache.org/content/groups/public'
        }
    }

  dependencies {
    classpath 'com.yahoo.vespa:configgen:7.28.21'
  }
}

def configCodegen(source, dest) { 
  return tasks.create("${source}".replaceAll("[^A-Za-z0-9]", "")) {
    if( !new File("${dest}").exists() ) {
      new File("${dest}").mkdirs() 
      FileTree tree = fileTree("${source}").include('*.def')
        tree.each {File file ->
          codegenSpec("${dest}", "${file}")
        }
    }
  }
}

def codegenSpec(dest, spec) {
    return tasks.create("${spec}".replaceAll("[^A-Za-z0-9]", "")) {
      if( !new File("${dest}").exists() ) {
        new File("${dest}").mkdirs()
      }

      javaexec {
        workingDir = file(buildDir)
        outputs.dir "${dest}"

        classpath = buildscript.configurations.classpath
        main = "com.yahoo.config.codegen.MakeConfig"
        jvmArgs = [ "-Dconfig.dest=${dest}", "-Dconfig.spec=${spec}" ]
      }
    }
}



