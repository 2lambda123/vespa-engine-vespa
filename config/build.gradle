/*
 * This file was generated by the Gradle 'init' task.
 */

dependencies {
    compile 'com.google.code.findbugs:annotations:1.3.9'
    compile 'com.yahoo.vespa:annotations:7.28.21'
    compile project(':config-lib')
    compile 'com.yahoo.vespa:configgen:7.28.21'
    compile project(':jrt')
    compile project(':vespajlib')
    compile project(':yolean')
    compile project(':vespalog')
    compile 'com.fasterxml.jackson.core:jackson-core:2.8.11'
    compile 'net.jpountz.lz4:lz4:1.3.0'
    testCompile junit_4
    testCompile hamcrest_core
    testCompile 'com.google.guava:guava-testlib:20.0'
    testCompile project(':testutil')
    compileOnly guava
}

compileTestJava.dependsOn generateConfigurationsTask(
	"${projectDir}/src/test/resources/configs", 
	"${buildDir}/generated-sources/configgen-test/")

task generateVtag(type: JavaExec) {
    dependsOn ":vespajlib:compileJava"
    workingDir = file(buildDir)
    outputs.dir "${buildDir}"

    classpath = files([
        "${rootDir}/vespajlib/build/classes/java/main"    
	])
    main = "com.yahoo.vespa.VersionTagger"
    args = [ "${rootDir}/dist/vtag.map", "com.yahoo.vespa.config", "${buildDir}/generated-sources/vtag" ]
}

compileJava.dependsOn generateVtag

sourceSets {
    main{
        java {
            srcDir "${buildDir}/generated-sources/vtag/"
        }
    }
}
