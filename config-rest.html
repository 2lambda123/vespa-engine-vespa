<!DOCTYPE html>
<!-- Copyright 2016 Yahoo Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->

<html lang="en">

<head>
  <title>Cloud Config REST API for listing and retrieving config</title>
  <link rel="stylesheet" href="http://vespa.corp.yahoo.com/css/vespadoc-standalone.css" />
  <meta name="date"    content="October 2012" />
  <meta name="authors" content="vegardh" />
</head>

<body>

<p class="ingress">
The Cloud Config System (CCS) provides a REST API for listing and retrieving config. This
API is useful for users of CCS that for various reasons do not want to use the
<a href="cloudconfig/configapi-dev-cpp.html">C++</a> or <a
href="cloudconfig/configapi-dev-java.html">Java</a> programmatic APIs to retrieve config.
</p>


<h1 id="overview">Overview</h1>

<p>
The config REST API provides a way to inspect and retrieve all the config
that can be generated by the config model.  Some, but not necessarily all, of
those configs are used by services by <a
href="cloudconfig/configapi-dev.html">subscribing</a> on them.
</p>

<p>
All cloud config servers provides the REST API. The default
port number is 19071.  You can check what the port number is for a
running config model by running <code>vespa-model-inspect service
configserver</code>.  An example URL would
be <code>http://&lt;host&gt;:19071/config/v1/</code>. The
response format is JSON.
</p>

<p>
The API is available after an application has
been <a href="cloudconfig/application-packages.html#deploying">deployed</a>
and activated</a>.
</p>

<h1 id="apispec">API Specification</h1>

<h2 id="list-configs">GET /config/v1/</h2>

<h3 id="list-configs-response">Response</h3>
<p>
List the configs in the model,
as <a href="cloudconfig/configapi-dev.html#config-id">config id</a> specific
URLs. A list response will include two arrays:
</p>

<ul>
  <li>A list of links to new lists for the first level of config id,
      if those children have other children, in other words: more
      below this.</li>
  <li>A list of config payload links for the children.</li>
</ul>

<h3 id="list-configs-params">Parameters</h3>
<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default value</th>
      <th>Description</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>recursive</td>
      <td>false</td>
      <td>If true, include each config id in the model which produces
          the config, and list only the links to the config payload.
          If false, include the first level of the config ids in the listing of new list URLs, as explained above.</td>
    </tr>
  </tbody>
</table>

<h3 id="list-configs-error">Error Response</h3>
<p>
&mdash;
</p>


<h3 id="list-configs-example1">Sample Response: GET /config/v1/</h3>
<pre>
{
  &quot;children&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/config.sentinel/&lt;host&gt;/&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.sentinel/hosts/&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.metricsproxy/hosts/&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.model/admin/&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/container.components/search/&quot;,
  &hellip;
  &quot;configs&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/config.sentinel/&lt;host&gt;&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.sentinel/hosts&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.metricsproxy/hosts&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.model/admin&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/container.components/search&quot;,
  &hellip;
</pre>


<h3 id="list-configs-example2">Sample response: GET /config/v1/?recursive=true</h3>
<pre>
{
  &quot;configs&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/config.sentinel/&lt;host&gt;&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.sentinel/hosts/&lt;host&gt;&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/config.metricsproxy/hosts/&lt;host&gt;/metricsproxy&quot;,
</pre>


<h2 id="list-namespace">GET /config/v1/[namespace.name]/</h2>

<h3 id="list-namespace-response">Response</h3>
<p>
List the configs in the model with the given namespace and name. List
semantics as above.
</p>

<h3 id="list-namespace-params">Parameters</h3>
<p>
Same as above.
</p>

<h3 id="list-namespace-error">Error Response</h3>
<p>
404 if the given namespace.name is not known to the config model.
</p>

<h3 id="list-namespace-example1">Sample Response: GET /config/v1/vespaclient.config.feeder/</h3>
<pre>
{
  &quot;children&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/search/&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/clients/&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/docproc/&quot;
  ]
  &quot;configs&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/search&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/clients&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/docproc&quot;
  ]
}
</pre>

<h3 id="list-namespace-example2">Sample response: GET /config/v1/vespaclient.config.feeder/?recursive=true</h3>

<pre>
{
  &quot;configs&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/search/qrsclusters/default&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/clients/gateways&quot;,
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/clients/gateways/gateway&quot;,
</pre>


<h2 id="list-prefix">GET /config/v1/[namespace.name]/[config/subid]/</h2>

<h3 id="list-prefix-response">Response</h3>
<p>
List the configs in the model with the given namespace and name, and
for which the given config id segment is a prefix.
</p>

<h3 id="list-prefix-params">Parameters</h3>
<p>
Same as above.
</p>

<h3 id="list-prefix-error">Error Response</h3>
<ul>
  <li>404 if the given namespace.name is not known to the config
      model.</li>
  <li>404 if the given config id is not in the model.</li>
</ul>

<h3 id="list-prefix-example1">Sample Response: GET /config/v1/vespaclient.config.feeder/search/</h3>
<pre>
{
  &quot;children&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/search/qrsclusters/&quot;
  ]
  &quot;configs&quot;: [
    &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/search/qrsclusters&quot;
  ]
}
</pre>

<h3 id="list-prefix-example2">Sample response: GET /config/v1/vespaclient.config.feeder/search/?recursive=true</h3>

<pre>
{
    &quot;configs&quot;: [
        &quot;http://&lt;host&gt;:19071/config/v1/vespaclient.config.feeder/search/qrsclusters/default&quot;
    ]
}
</pre>

<h2 id="payload">GET /config/v1/[namespace.name]/[config/id]</h2>

<h3 id="payload-response">Response</h3>
<p>
Returns the config payload of the
given <code>namespace.name/config/id</code>, formatted as JSON.
</p>

<h3 id="payload-params">Parameters</h3>
<p>
&mdash;
</p>

<h3 id="payload-error">Error Response</h3>

<p>
Same as above.
</p>

<h3 id="payload-example1">Sample response: GET /config/v1/container.core.container-http/search/qrsclusters/default/qrserver.0</h3>
<pre>
{
  &quot;enabled&quot;: &quot;true&quot;,
  &quot;requestbuffersize&quot;: &quot;65536&quot;,
  &quot;port&quot;: {
    &quot;search&quot;: &quot;8080&quot;,
    &quot;host&quot;: &quot;&quot;
  },
  &quot;fileserver&quot;: {
    &quot;throughsearch&quot;: &quot;true&quot;
  }
}
</pre>



<h1 id="browser-support">Browser Support</h1>

<p>
When manually examining this API, use a browser plugin which
visualizes JSON neatly, such as
<a href="https://addons.mozilla.org/en-US/firefox/addon/jsonview/">JSONView</a> for Firefox.
</p>

</body>
</html>
