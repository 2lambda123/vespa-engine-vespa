<!DOCTYPE html>
<!-- Copyright 2016 Yahoo Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root. -->
<html lang="en">

<head>
  <title>Cloud Config REST API for listing and retrieving config (v2)</title>
  <link rel="stylesheet" href="http://vespa.corp.yahoo.com/css/vespadoc-standalone.css" />
  <meta name="date"    content="October 2013" />
  <meta name="authors" content="vegardh" />
</head>

<body>

<p class="ingress">
The Cloud Config System (CCS) provides a REST API for listing and retrieving config. This
API is useful for users of CCS that for various reasons do not want to use the
<a href="configapi-dev-cpp.html">C++</a> or <a
href="configapi-dev-java.html">Java</a> programmatic APIs to retrieve config.
</p>

<h1 id="overview">Overview</h1>

<p>
The config REST API provides a way to inspect and retrieve all the config
that can be generated by the config model for a given <a href="deploy-rest-api-v2.html">tenant's active application</a>.
Some, but not necessarily all, of those configs are used by services by <a
href="configapi-dev.html">subscribing</a> on them.
</p>

<p>
All cloud config servers provide the REST API. The default
port number is 19071.  You can check what the port number is for a
running config model by running <code>vespa-model-inspect service
configserver</code>.  An example URL would
be <code>http://myconfigserver.mydomain.com:19071/config/v2/tenant/msbe/application/articlesearch/</code>.
The response format is JSON.
</p>

<p>
The API is available after an application has
been <a href="application-packages.html#deploying">deployed
and activated</a>.
</p>

<h1 id="application-id">The application id</h1>

<p>
The API provides two ways to identify your application, given a tenant: one using only an application name, and one using application name, environment, region and instance. For the former, "short" form,
a default environment, region and instance is used.

<p>
More formally, an <em>application id</em> is a tuple of the form (<em>application</em>, <em>environment</em>, <em>region</em>, <em>instance</em>).
The system currently provides shorthand to the id (<em>application</em>, "default", "default", "default").

<p>
Note: Multiple environments, regions and instances are not currently supported for application deployments, default is always used.

<p>
Example URLs for these two forms with explanation of the parts follows.

<h2 id="example-short-appid">Example URL using only application name</h2>

<p>
<code>http://myconfigserver.mydomain.com:19071/config/v2/tenant/msbe/application/articlesearch/msbe.config.server-list/clusters/0</code>

<p>
Description:

<table>
<thead>
	<tr>
		<th>Part</th>
		<th>Description</th>
	</tr>
</thead>
	<tr>
		<td>msbe</td>
		<td>The tenant</td>
	</tr>
	<tr>
		<td>articlesearch</td>
		<td>The name of the application</td>		
	</tr>
	<tr>
		<td>msbe.config</td>
		<td>The namespace of the config requested</td>		
	</tr>
	<tr>
		<td>server-list</td>
		<td>The name of the config requested</td>		
	</tr>
	<tr>
		<td>clusters/0</td>
		<td>The config id of the config requested</td>		
	</tr>
</table>

<h2 id="example-long-appid">Example URL using full application id</h2>
		
<p>
<code>http://myconfigserver.mydomain.com:19071/config/v2/tenant/msbe/application/articlesearch/environment/test/region/us/instance/staging/msbe.config.server-list/clusters/0</code>

<p>
Description:

<table>
<thead>
	<tr>
		<th>Part</th>
		<th>Description</th>
	</tr>
</thead>
	<tr>
		<td>msbe</td>
		<td>The tenant</td>
	</tr>
	<tr>
		<td>articlesearch</td>
		<td>The name of the application</td>		
	</tr>
	<tr>
		<td>test</td>
		<td>The environment</td>		
	</tr>
	<tr>
		<td>us</td>
		<td>The region</td>		
	</tr>
	<tr>
		<td>staging</td>
		<td>The instance</td>		
	</tr>
	<tr>
		<td>msbe.config</td>
		<td>The namespace of the config requested</td>		
	</tr>
	<tr>
		<td>server-list</td>
		<td>The name of the config requested</td>		
	</tr>
	<tr>
		<td>clusters/0</td>
		<td>The config id of the config requested</td>		
	</tr>
</table>

<h1 id="apispec">API Specification</h1>

<p>
Note: In the API specification, we use the short form of the application id, where only the application name is used. The tenant <code>mytenant</code> and the 
application name <code>myapplication</code> is used throughout.

<h2 id="list-configs">GET /config/v2/tenant/mytenant/application/myapplication/</h2>

<h3 id="list-configs-response">Response</h3>
<p>
List the configs in the model,
as <a href="configapi-dev.html#config-id">config id</a> specific
URLs. A list response will include two arrays:
</p>

<ul>
  <li>List-links to descend one level down in the config id hierarchy, named <code>children</code>.</li>
  <li><a href="#payload">Config payload</a> links for the current (top) level, named <code>configs</code>.
  <em>Note: This is different from the <a href="../config-rest.html#list-configs-response">v1 API</a>.</em></li>
</ul>

<h3 id="list-configs-params">Parameters</h3>
<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Default value</th>
      <th>Description</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <td>recursive</td>
      <td>false</td>
      <td>If true, include each config id in the model which produces
          the config, and list only the links to the config payload.
          If false, include the first level of the config ids in the listing of new list URLs, as explained above.</td>
    </tr>
  </tbody>
</table>

<h3 id="list-configs-error">Error Response</h3>
<p>
-
</p>

<h3 id="list-configs-example1">Sample Response: GET /config/v2/tenant/mytenant/application/myapplication/</h3>
<pre>
{
  "children": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.sentinel/myconfigserver.mydomain.com/",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.sentinel/hosts/",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.model/admin/",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/container.components/search/"
  &hellip;  
  "configs": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.sentinel",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.model",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/container.components"
  &hellip;
</pre>

<h3 id="list-configs-example2">Sample response: GET /config/v2/tenant/mytenant/application/myapplication/?recursive=true</h3>
<pre>
{
  "configs": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.sentinel/myconfigserver.mydomain.com",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/config.sentinel/hosts/myconfigserver.mydomain.com"
</pre>

<h2 id="list-namespace">GET /config/v2/tenant/mytenant/application/myapplication/[namespace.name]/</h2>

<h3 id="list-namespace-response">Response</h3>
<p>
List the configs in the model with the given namespace and name. List
semantics as above.
</p>

<h3 id="list-namespace-params">Parameters</h3>
<p>
Same as above.
</p>

<h3 id="list-namespace-error">Error Response</h3>
<p>
404 if the given namespace.name is not known to the config model.
</p>

<h3 id="list-namespace-example1">Sample Response: GET /config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/</h3>
<pre>
{
  "children": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search/",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/clients/",
    "http://myconfigserver.mydomain.com:19071/config/v1/vespaclient.config.feeder/docproc/"
  ]
  "configs": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder",
  ]
}
</pre>

<h3 id="list-namespace-example2">Sample response: GET /config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/?recursive=true</h3>

<pre>
{
  "configs": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search/qrsclusters/default",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/clients/gateways",
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/clients/gateways/gateway",
</pre>

<h2 id="list-prefix">GET /config/v2/tenant/mytenant/application/myapplication/[namespace.name]/[config/subid]/</h2>

<h3 id="list-prefix-response">Response</h3>
<p>
List the configs in the model with the given namespace and name, and
for which the given config id segment is a prefix.
</p>

<h3 id="list-prefix-params">Parameters</h3>
<p>
Same as above.
</p>

<h3 id="list-prefix-error">Error Response</h3>
<ul>
  <li>404 if the given namespace.name is not known to the config
      model.</li>
  <li>404 if the given config id is not in the model.</li>
</ul>

<h3 id="list-prefix-example1">Sample Response: GET /config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search/</h3>
<pre>
{
  "children": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search/qrsclusters/"
  ]
  "configs": [
    "http://myconfigserver.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search"
  ]
}
</pre>

<h3 id="list-prefix-example2">Sample response: GET /config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search/?recursive=true</h3>

<pre>
{
    "configs": [
        "http://myhost.mydomain.com:19071/config/v2/tenant/mytenant/application/myapplication/vespaclient.config.feeder/search/qrsclusters/default"
    ]
}
</pre>

<h2 id="payload">GET /config/v2/tenant/mytenant/application/myapplication/[namespace.name]/[config/id]</h2>

<h3 id="payload-response">Response</h3>
<p>
Returns the config payload of the
given <code>namespace.name/config/id</code>, formatted as JSON.
</p>

<h3 id="payload-params">Parameters</h3>
<p>
-
</p>

<h3 id="payload-error">Error Response</h3>

<p>
Same as above.
</p>

<h3 id="payload-example1">Sample response: GET /config/v2/tenant/mytenant/application/myapplication/container.core.container-http/search/qrsclusters/default/qrserver.0</h3>
<pre>
{
  "enabled": "true",
  "requestbuffersize": "65536",
  "port": {
    "search": "8080",
    "host": ""
  },
  "fileserver": {
    "throughsearch": "true"
  }
}
</pre>

<h1 id="browser-support">Browser Support</h1>

<p>
When manually examining this API, use a browser plugin which
visualizes JSON neatly, such as
<a href="https://addons.mozilla.org/en-US/firefox/addon/jsonview/">JSONView</a> for Firefox. 
</p>

</body></html>
